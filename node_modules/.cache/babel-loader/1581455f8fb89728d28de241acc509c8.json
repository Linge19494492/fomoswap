{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zhaohongwei/Downloads/fomoswap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/zhaohongwei/Downloads/fomoswap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/zhaohongwei/Downloads/fomoswap/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import MuiAlert from'@material-ui/lab/Alert';import Snackbar from'@material-ui/core/Snackbar';import DetailItem from'../../components/DetailItem/DetailItem';import MsgBox from'../../components/MsgBox/MsgBox';import Loading from'../../components/Loading';import{useLocation}from'react-router-dom';import{useTranslation}from'react-i18next';// import tigerLogo from '../../assets/tiger-logo.png';\nimport tigerLogo from'../../assets/1.png';import wallet from'../../tools/wallet';import conf from'../../tools/conf';import{sleep,getUrlParams,formatBigNumber}from'../../tools';import'./Detail.css';var _require=require('../../assets/converge'),poolTitleImg=_require.poolTitleImg;// 池子标题名字\nvar poolTitleName={usdtPoolAddress:'USDT/TRX LP',fomoPoolAddress:'FOMO/TRX LP',fomoX9PoolAddress:'FOMOX9/TRX LP',mvmPoolAddress:'MVM/TRX LP',famPoolAddress:'FAM/TRX LP'};function Alert(props){return/*#__PURE__*/React.createElement(MuiAlert,Object.assign({elevation:6,variant:\"filled\"},props));}function Detail(){var _useTranslation=useTranslation(),t=_useTranslation.t;// 使用这个变量去区分是哪个池子，个性化设置等、比如图标之类\n// 真不理解为什么不用 pollName 这个变量去做，非要再处理个 src 属性\nvar _getUrlParams=getUrlParams(useLocation().search),poolName=_getUrlParams.poolName;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),popType=_useState4[0],setPopType=_useState4[1];// 根据状态去判断当前功能、0 批准，1 解压，2质押\nvar _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),obtained=_useState6[0],setObtained=_useState6[1];// 已获得\nvar _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),pledged=_useState8[0],setPledged=_useState8[1];// 已抵押\n// 是否批准，根据 isApproved 这个变量显示显示几个按钮，为 false 一个按钮， true 为两个按钮\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isApproved=_useState10[0],setApproved=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),lpBalance=_useState12[0],setLpBalance=_useState12[1];// lp 余额\nvar _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),amountSubmitted=_useState14[0],setAmountSubmitted=_useState14[1];// 提交的金额\nvar _useState15=useState(true),_useState16=_slicedToArray(_useState15,2),isLoading=_useState16[0],setLoading=_useState16[1];// 加载状态\nvar _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),openError=_React$useState2[0],setOpenError=_React$useState2[1];// 错误提示\nvar _React$useState3=React.useState('This is a error!'),_React$useState4=_slicedToArray(_React$useState3,2),errorInfo=_React$useState4[0],setErrorInfo=_React$useState4[1];// 错误提信息\n// 一起更新所有吧\nvar upDateAll=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var myAddress,poolAddress,lpAddress,_yield$Promise$all,_yield$Promise$all2,earnedRes,pledgedRes,allowanceRes,lpRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(wallet.getDefaultAddress().code===0)){_context.next=19;break;}myAddress=wallet.getDefaultAddress().data;poolAddress=conf.pool[poolName];lpAddress=conf.lp[poolName];// console.log(myAddress)\n// console.log(poolAddress)\n// console.log(lpAddress)\n_context.next=6;return Promise.all([wallet._getEarned(poolAddress),wallet._getBalanceOf(poolAddress,myAddress),wallet.allowance(lpAddress,myAddress,poolAddress),wallet._getBalanceOf(lpAddress,myAddress)]);case 6:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,4);earnedRes=_yield$Promise$all2[0];pledgedRes=_yield$Promise$all2[1];allowanceRes=_yield$Promise$all2[2];lpRes=_yield$Promise$all2[3];setObtained(formatBigNumber(earnedRes.data));// if (poolName === 'cornPoolAddress') {\n//     setPledged((Number(formatBigNumber(pledgedRes.data, 1e18))));\n//     setLpBalance((Number(formatBigNumber(lpRes.data, 1e18))));\n// } else {\n//     setPledged(Number(formatBigNumber(pledgedRes.data, 1e6)));\n//     setLpBalance(Number(formatBigNumber(lpRes.data, 1e6)));\n// }\nsetPledged(Number(formatBigNumber(pledgedRes.data,1e6)));setLpBalance(Number(formatBigNumber(lpRes.data,1e6)));if(allowanceRes.data.comparedTo(1)>0){setApproved(true);}else{setApproved(false);}setLoading(false);_context.next=19;break;case 19:case\"end\":return _context.stop();}}},_callee);}));return function upDateAll(){return _ref.apply(this,arguments);};}();// 收割\nvar onclickHarvest=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(Number(obtained)>0)){_context2.next=5;break;}// 可以添加 loading 开始，其实就是控制一个变量为 true\nconsole.log('开始收割');_context2.next=4;return wallet.getReward(conf.pool[poolName]);case 4:// 这里可以监听错误\nconsole.log('收割完成');// 结束 loading 开始，其实就是控制一个变量为 false\ncase 5:case\"end\":return _context2.stop();}}},_callee2);}));return function onclickHarvest(){return _ref2.apply(this,arguments);};}();// 轮训，更新，10 秒更新一次\nvar training=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return sleep(20*1000);case 2:_context3.prev=2;_context3.next=5;return sleep(8*1000);case 5:_context3.next=7;return upDateAll();case 7:_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](2);console.error(_context3.t0);case 12:_context3.next=2;break;case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[2,9]]);}));return function training(){return _ref3.apply(this,arguments);};}();// 收割并解压\nvar onClickExit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(obtained<=0){console.log('数量不足');// return;\n}else{console.log('return');}// 可以添加 loading 开始，其实就是控制一个变量为 true\nconsole.log('开始收割并解压');_context4.next=4;return wallet.exit(conf.pool[poolName]);case 4:// 这里可以监听错误\nupDateAll();console.log('收割并解压完成');// 结束 loading 开始，其实就是控制一个变量为 false\ncase 6:case\"end\":return _context4.stop();}}},_callee4);}));return function onClickExit(){return _ref4.apply(this,arguments);};}();// 批准授权\nvar approveAuthor=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;// 可以添加 loading 开始，其实就是控制一个变量为 true\nconsole.log('开始批准授权');_context5.next=4;return wallet.approve(conf.lp[poolName],conf.pool[poolName]);case 4:// 这里可以监听错误\nupDateAll();console.log('批准授权完成');// 结束 loading 开始，其实就是控制一个变量为 false\n_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[0,8]]);}));return function approveAuthor(){return _ref5.apply(this,arguments);};}();// 质押\nvar invest=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var amount;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(amountSubmitted<=0)){_context6.next=2;break;}return _context6.abrupt(\"return\");case 2:// 可以添加 loading 开始，其实就是控制一个变量为 true\nconsole.log('开始质押>>>',amountSubmitted);amount=amountSubmitted;// if (poolName === 'cornPoolAddress') {\n//     await wallet.safeInvest(conf.pool[poolName], conf.lp[poolName], (amount * 1e18)); // 这里可以监听错误\n// } else {\n//     await wallet.safeInvest(conf.pool[poolName], conf.lp[poolName], (amount * 1e6)); // 这里可以监听错误\n// }\n_context6.next=6;return wallet.safeInvest(conf.pool[poolName],conf.lp[poolName],amount*1e6);case 6:_context6.next=8;return sleep(50);case 8:// 区块链有延迟 延迟一下再去获取\nsetAmountSubmitted(0);upDateAll();console.log('质押完成');// 结束 loading 开始，其实就是控制一个变量为 false\ncase 11:case\"end\":return _context6.stop();}}},_callee6);}));return function invest(){return _ref6.apply(this,arguments);};}();// 撤出投资\nvar withdraw=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var amount;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!(amountSubmitted<=0)){_context7.next=2;break;}return _context7.abrupt(\"return\");case 2:// 可以添加 loading 开始，其实就是控制一个变量为 true\nconsole.log('开始撤出投资');amount=amountSubmitted;if(!(poolName==='cornPoolAddress')){_context7.next=9;break;}_context7.next=7;return wallet.withdraw(conf.pool[poolName],(amount*1e18).toString());case 7:_context7.next=11;break;case 9:_context7.next=11;return wallet.withdraw(conf.pool[poolName],(amount*1e6).toString());case 11:_context7.next=13;return sleep(50);case 13:// 区块链有延迟 延迟一下再去获取\nsetAmountSubmitted(0);upDateAll();console.log('撤出投资完成');// 结束 loading 开始，其实就是控制一个变量为 false\ncase 16:case\"end\":return _context7.stop();}}},_callee7);}));return function withdraw(){return _ref7.apply(this,arguments);};}();useEffect(function(){wallet.eventEmitter.on(wallet.eventConstant.wallet_connection,upDateAll);// upDateAll();\ntraining();// 轮训\nreturn function(){wallet.eventEmitter.removeListener(wallet.eventConstant.wallet_connection,upDateAll);};},[]);// 监听输入框的数据\nvar inputHandleChange=function inputHandleChange(event){// let curValue = Number(event.target.value);\nsetAmountSubmitted(event.target.value);};var calcAvailable=function calcAvailable(){console.log('lpBalance>>>>>',lpBalance);if(popType===1){return\"\\u53EF\\u7528\\uFF1A\".concat(pledged,\" \").concat(poolTitleName[poolName]);}else if(popType===2){return\"\\u53EF\\u7528\\uFF1A\".concat(lpBalance,\" \").concat(poolTitleName[poolName]);}};var msg=/*#__PURE__*/React.createElement(\"div\",{className:\"msg-box-body\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"awaylable-money\"},calcAvailable()),/*#__PURE__*/React.createElement(\"div\",{className:\"input-box\"},/*#__PURE__*/React.createElement(\"input\",{className:\"input\",type:\"text\",value:amountSubmitted,onChange:inputHandleChange}),/*#__PURE__*/React.createElement(\"div\",{className:\"max-money btn\",onClick:function onClick(){if(popType===1){setAmountSubmitted(parseFloat(pledged));}else if(popType===2){setAmountSubmitted(parseFloat(lpBalance));}}},t('detail.max')))));function showMsgBox(type){console.log(type);setPopType(type);if(type===0){approveAuthor();return;}setShow(true);}function confirmCallBack(type){if(type){if(popType===1){if(!/^\\d+(?=\\.{0,1}\\d+$|$)/.test(amountSubmitted)){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}if(!parseFloat(amountSubmitted)){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}if(parseFloat(amountSubmitted)>pledged){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}withdraw();}else{if(!/^\\d+(?=\\.{0,1}\\d+$|$)/.test(amountSubmitted)){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}if(!parseFloat(amountSubmitted)){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}if(parseFloat(amountSubmitted)>lpBalance){setErrorInfo(t('detail.insufficientBalance'));setOpenError(true);return;}invest();}}else{setAmountSubmitted(0);}setShow(false);}var detaiItem;if(!isApproved){detaiItem=/*#__PURE__*/React.createElement(DetailItem,{src:poolTitleImg[poolName],number:pledged,text:poolTitleName[poolName]+t('detail.staked'),btnText:t('detail.feed')+poolTitleName[poolName],onClick:showMsgBox});}else{detaiItem=/*#__PURE__*/React.createElement(DetailItem,{src:poolTitleImg[poolName],number:pledged,text:poolTitleName[poolName]+t('detail.staked'),btnText:t('detail.unstake'),btnText2:t('detail.pledge'),onClick:showMsgBox});}var backGround={background:\"url(\".concat(poolTitleImg[poolName],\")\"),backgroundRepeat:'no-repeat',backgroundSize:'100%',backgroundPosition:'center'};var earn=\"\";var earned=\"\";if(poolName==\"usdtPoolAddress\"||poolName==\"fomoX9PoolAddress\"){earn=t('detail.earn_fomo');earned=/*#__PURE__*/React.createElement(DetailItem,{src:poolTitleImg[\"fomoTrc20\"],number:obtained,text:t('detail.earned_fomo'),btnText:t('detail.adopt'),onClick:onclickHarvest});}else{earn=t('detail.earn_fomox9');earned=/*#__PURE__*/React.createElement(DetailItem,{src:poolTitleImg[\"fomoX9Trc20\"],number:obtained,text:t('detail.earned_fomox9'),btnText:t('detail.adopt'),onClick:onclickHarvest});}var rendering=function rendering(){if(isLoading){return/*#__PURE__*/React.createElement(Loading,null);}else{return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"detai-list\"},earned,detaiItem),/*#__PURE__*/React.createElement(\"div\",{className:\"detai-btn btn\",onClick:onClickExit},t('detail.adoptAndUnstake')));}};return/*#__PURE__*/React.createElement(\"div\",{className:\"detail\"},/*#__PURE__*/React.createElement(\"div\",{className:\"detail-slogan\"},/*#__PURE__*/React.createElement(\"div\",{className:\"slogan-logo\"},/*#__PURE__*/React.createElement(\"div\",{className:\"slogan-logo-img\",style:backGround})),/*#__PURE__*/React.createElement(\"div\",{className:\"text-logo\"},/*#__PURE__*/React.createElement(\"div\",{className:\"text-logo-text1\"},poolTitleName[poolName])),/*#__PURE__*/React.createElement(\"div\",{className:\"slogan-title\"},/*#__PURE__*/React.createElement(\"div\",null,t('detail.deposit')),/*#__PURE__*/React.createElement(\"div\",{className:\"slogan-title-name\"},\"\\xA0\",poolTitleName[poolName],\"\\xA0\"),/*#__PURE__*/React.createElement(\"div\",null,earn))),rendering(),show&&/*#__PURE__*/React.createElement(MsgBox,{msg:msg,title:t('detail.feed2'),popType:popType,confirm:true,confirmCallBack:confirmCallBack}),/*#__PURE__*/React.createElement(Snackbar,{anchorOrigin:{vertical:'top',horizontal:'right'},open:openError,autoHideDuration:1500,onClose:setOpenError},/*#__PURE__*/React.createElement(Alert,{severity:\"error\"},errorInfo)));}export default Detail;","map":{"version":3,"sources":["/Users/zhaohongwei/Downloads/fomoswap/src/views/Detail/Detail.js"],"names":["React","useState","useEffect","MuiAlert","Snackbar","DetailItem","MsgBox","Loading","useLocation","useTranslation","tigerLogo","wallet","conf","sleep","getUrlParams","formatBigNumber","require","poolTitleImg","poolTitleName","usdtPoolAddress","fomoPoolAddress","fomoX9PoolAddress","mvmPoolAddress","famPoolAddress","Alert","props","Detail","t","search","poolName","show","setShow","popType","setPopType","obtained","setObtained","pledged","setPledged","isApproved","setApproved","lpBalance","setLpBalance","amountSubmitted","setAmountSubmitted","isLoading","setLoading","openError","setOpenError","errorInfo","setErrorInfo","upDateAll","getDefaultAddress","code","myAddress","data","poolAddress","pool","lpAddress","lp","Promise","all","_getEarned","_getBalanceOf","allowance","earnedRes","pledgedRes","allowanceRes","lpRes","Number","comparedTo","onclickHarvest","console","log","getReward","training","error","onClickExit","exit","approveAuthor","approve","invest","amount","safeInvest","withdraw","toString","eventEmitter","on","eventConstant","wallet_connection","removeListener","inputHandleChange","event","target","value","calcAvailable","msg","parseFloat","showMsgBox","type","confirmCallBack","test","detaiItem","backGround","background","backgroundRepeat","backgroundSize","backgroundPosition","earn","earned","rendering","vertical","horizontal"],"mappings":"idAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,KAAyC,OAAzC,CAEA,MAAOC,CAAAA,QAAP,KAAqB,wBAArB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CAEA,MAAOC,CAAAA,UAAP,KAAuB,wCAAvB,CACA,MAAOC,CAAAA,MAAP,KAAmB,gCAAnB,CAEA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CAEA,OAAQC,WAAR,KAA0B,kBAA1B,CACA,OAAQC,cAAR,KAA6B,eAA7B,CAEA;AACA,MAAOC,CAAAA,SAAP,KAAsB,oBAAtB,CAEA,MAAOC,CAAAA,MAAP,KAAmB,oBAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,kBAAjB,CAEA,OAAQC,KAAR,CAAeC,YAAf,CAA6BC,eAA7B,KAAmD,aAAnD,CAEA,MAAO,cAAP,C,aAEuBC,OAAO,CAAC,uBAAD,C,CAAvBC,Y,UAAAA,Y,CAEP;AACA,GAAMC,CAAAA,aAAa,CAAG,CAClBC,eAAe,CAAI,aADD,CAElBC,eAAe,CAAI,aAFD,CAGlBC,iBAAiB,CAAE,eAHD,CAIlBC,cAAc,CAAK,YAJD,CAKlBC,cAAc,CAAK,YALD,CAAtB,CAQA,QAASC,CAAAA,KAAT,CAAeC,KAAf,CAAsB,CAClB,mBAAO,oBAAC,QAAD,gBAAU,SAAS,CAAE,CAArB,CAAwB,OAAO,CAAC,QAAhC,EAA6CA,KAA7C,EAAP,CACH,CAED,QAASC,CAAAA,MAAT,EAAkB,qBAEFjB,cAAc,EAFZ,CAEPkB,CAFO,iBAEPA,CAFO,CAId;AACA;AALc,kBAMKb,YAAY,CAACN,WAAW,GAAGoB,MAAf,CANjB,CAMPC,QANO,eAMPA,QANO,eAQgB5B,QAAQ,CAAC,KAAD,CARxB,wCAQP6B,IARO,eAQDC,OARC,8BASgB9B,QAAQ,CAAC,CAAD,CATxB,yCASP+B,OATO,eASEC,UATF,eAS4B;AAT5B,eAWkBhC,QAAQ,CAAC,CAAD,CAX1B,yCAWPiC,QAXO,eAWGC,WAXH,eAW8B;AAX9B,eAYkBlC,QAAQ,CAAC,CAAD,CAZ1B,yCAYPmC,OAZO,eAYEC,UAZF,eAY8B;AAE5C;AAdc,eAeoBpC,QAAQ,CAAC,KAAD,CAf5B,0CAePqC,UAfO,gBAeKC,WAfL,gCAiBoBtC,QAAQ,CAAC,CAAD,CAjB5B,2CAiBPuC,SAjBO,gBAiBIC,YAjBJ,gBAiBgC;AAjBhC,gBAmBgCxC,QAAQ,CAAC,CAAD,CAnBxC,2CAmBPyC,eAnBO,gBAmBUC,kBAnBV,gBAmB4C;AAnB5C,gBAoBgC1C,QAAQ,CAAC,IAAD,CApBxC,2CAoBP2C,SApBO,gBAoBIC,UApBJ,gBAoB+C;AApB/C,oBAsBoB7C,KAAK,CAACC,QAAN,CAAe,KAAf,CAtBpB,oDAsBP6C,SAtBO,qBAsBIC,YAtBJ,qBAsB0C;AAtB1C,qBAuBoB/C,KAAK,CAACC,QAAN,CAAe,kBAAf,CAvBpB,qDAuBP+C,SAvBO,qBAuBIC,YAvBJ,qBAuBuD;AAErE;AACA,GAAMC,CAAAA,SAAS,0FAAG,2PAEVvC,MAAM,CAACwC,iBAAP,GAA2BC,IAA3B,GAAoC,CAF1B,2BAIJC,SAJI,CAIU1C,MAAM,CAACwC,iBAAP,GAA2BG,IAJrC,CAKJC,WALI,CAKU3C,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CALV,CAMJ4B,SANI,CAMU7C,IAAI,CAAC8C,EAAL,CAAQ7B,QAAR,CANV,CAOtB;AACA;AACA;AATsB,sBAUiD8B,CAAAA,OAAO,CAACC,GAAR,CAAY,CACnEjD,MAAM,CAACkD,UAAP,CAAkBN,WAAlB,CADmE,CAEnE5C,MAAM,CAACmD,aAAP,CAAqBP,WAArB,CAAkCF,SAAlC,CAFmE,CAGnE1C,MAAM,CAACoD,SAAP,CAAiBN,SAAjB,CAA4BJ,SAA5B,CAAuCE,WAAvC,CAHmE,CAInE5C,MAAM,CAACmD,aAAP,CAAqBL,SAArB,CAAgCJ,SAAhC,CAJmE,CAAZ,CAVjD,kGAUHW,SAVG,wBAUQC,UAVR,wBAUoBC,YAVpB,wBAUkCC,KAVlC,wBAiBVhC,WAAW,CAACpB,eAAe,CAACiD,SAAS,CAACV,IAAX,CAAhB,CAAX,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACAjB,UAAU,CAAC+B,MAAM,CAACrD,eAAe,CAACkD,UAAU,CAACX,IAAZ,CAAkB,GAAlB,CAAhB,CAAP,CAAV,CACAb,YAAY,CAAC2B,MAAM,CAACrD,eAAe,CAACoD,KAAK,CAACb,IAAP,CAAa,GAAb,CAAhB,CAAP,CAAZ,CAEA,GAAIY,YAAY,CAACZ,IAAb,CAAkBe,UAAlB,CAA6B,CAA7B,EAAkC,CAAtC,CAAyC,CACrC9B,WAAW,CAAC,IAAD,CAAX,CACH,CAFD,IAEO,CACHA,WAAW,CAAC,KAAD,CAAX,CACH,CAEDM,UAAU,CAAC,KAAD,CAAV,CAnCU,8EAAH,kBAATK,CAAAA,SAAS,0CAAf,CA2CA;AACA,GAAMoB,CAAAA,cAAc,2FAAG,6IACfF,MAAM,CAAClC,QAAD,CAAN,CAAmB,CADJ,2BAGf;AACAqC,OAAO,CAACC,GAAR,CAAY,MAAZ,EAJe,uBAMT7D,CAAAA,MAAM,CAAC8D,SAAP,CAAiB7D,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAjB,CANS,QAM6B;AAE5C0C,OAAO,CAACC,GAAR,CAAY,MAAZ,EACA;AATe,wDAAH,kBAAdF,CAAAA,cAAc,2CAApB,CAaA;AACA,GAAMI,CAAAA,QAAQ,2FAAG,+JAEP7D,CAAAA,KAAK,CAAC,GAAK,IAAN,CAFE,gDAMCA,CAAAA,KAAK,CAAC,EAAI,IAAL,CANN,+BAOCqC,CAAAA,SAAS,EAPV,2FASLqB,OAAO,CAACI,KAAR,eATK,qGAAH,kBAARD,CAAAA,QAAQ,2CAAd,CAcA;AACA,GAAME,CAAAA,WAAW,2FAAG,wIAEhB,GAAI1C,QAAQ,EAAI,CAAhB,CAAmB,CACfqC,OAAO,CAACC,GAAR,CAAY,MAAZ,EACA;AACH,CAHD,IAGO,CACHD,OAAO,CAACC,GAAR,CAAY,QAAZ,EACH,CAED;AACAD,OAAO,CAACC,GAAR,CAAY,SAAZ,EAVgB,uBAYV7D,CAAAA,MAAM,CAACkE,IAAP,CAAYjE,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAZ,CAZU,QAYuB;AAEvCqB,SAAS,GACTqB,OAAO,CAACC,GAAR,CAAY,SAAZ,EACA;AAhBgB,wDAAH,kBAAXI,CAAAA,WAAW,2CAAjB,CAmBA;AACA,GAAME,CAAAA,aAAa,2FAAG,yJAGd;AACAP,OAAO,CAACC,GAAR,CAAY,QAAZ,EAJc,uBAMR7D,CAAAA,MAAM,CAACoE,OAAP,CAAenE,IAAI,CAAC8C,EAAL,CAAQ7B,QAAR,CAAf,CAAkCjB,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAlC,CANQ,QAM+C;AAE7DqB,SAAS,GACTqB,OAAO,CAACC,GAAR,CAAY,QAAZ,EACA;AAVc,mFAYdD,OAAO,CAACI,KAAR,eAZc,sEAAH,kBAAbG,CAAAA,aAAa,2CAAnB,CAiBA;AACA,GAAME,CAAAA,MAAM,2FAAG,wJAEPtC,eAAe,EAAI,CAFZ,oEAIX;AACA6B,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB9B,eAAvB,EAEMuC,MAPK,CAOIvC,eAPJ,CASX;AACA;AACA;AACA;AACA;AAbW,uBAcL/B,CAAAA,MAAM,CAACuE,UAAP,CAAkBtE,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAlB,CAAuCjB,IAAI,CAAC8C,EAAL,CAAQ7B,QAAR,CAAvC,CAA2DoD,MAAM,CAAG,GAApE,CAdK,+BAiBLpE,CAAAA,KAAK,CAAC,EAAD,CAjBA,QAiBK;AAChB8B,kBAAkB,CAAC,CAAD,CAAlB,CACAO,SAAS,GAETqB,OAAO,CAACC,GAAR,CAAY,MAAZ,EACA;AAtBW,yDAAH,kBAANQ,CAAAA,MAAM,2CAAZ,CAyBA;AACA,GAAMG,CAAAA,QAAQ,2FAAG,wJAETzC,eAAe,EAAI,CAFV,oEAIb;AACA6B,OAAO,CAACC,GAAR,CAAY,QAAZ,EAEMS,MAPO,CAOEvC,eAPF,MASTb,QAAQ,GAAK,iBATJ,kDAUHlB,CAAAA,MAAM,CAACwE,QAAP,CAAgBvE,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAhB,CAAqC,CAACoD,MAAM,CAAG,IAAV,EAAgBG,QAAhB,EAArC,CAVG,+DAaHzE,CAAAA,MAAM,CAACwE,QAAP,CAAgBvE,IAAI,CAAC4C,IAAL,CAAU3B,QAAV,CAAhB,CAAqC,CAACoD,MAAM,CAAG,GAAV,EAAeG,QAAf,EAArC,CAbG,iCAiBPvE,CAAAA,KAAK,CAAC,EAAD,CAjBE,SAiBG;AAChB8B,kBAAkB,CAAC,CAAD,CAAlB,CAEAO,SAAS,GACTqB,OAAO,CAACC,GAAR,CAAY,QAAZ,EACA;AAtBa,yDAAH,kBAARW,CAAAA,QAAQ,2CAAd,CAyBAjF,SAAS,CAAC,UAAM,CACZS,MAAM,CAAC0E,YAAP,CAAoBC,EAApB,CAAuB3E,MAAM,CAAC4E,aAAP,CAAqBC,iBAA5C,CAA+DtC,SAA/D,EAEA;AACAwB,QAAQ,GAAG;AAEX,MAAO,WAAM,CACT/D,MAAM,CAAC0E,YAAP,CAAoBI,cAApB,CAAmC9E,MAAM,CAAC4E,aAAP,CAAqBC,iBAAxD,CAA2EtC,SAA3E,EACH,CAFD,CAGH,CATQ,CASN,EATM,CAAT,CAWA;AACA,GAAMwC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,KAAD,CAAW,CAEjC;AAEAhD,kBAAkB,CAACgD,KAAK,CAACC,MAAN,CAAaC,KAAd,CAAlB,CACH,CALD,CAOA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CACxBvB,OAAO,CAACC,GAAR,CAAY,gBAAZ,CAA8BhC,SAA9B,EACA,GAAIR,OAAO,GAAK,CAAhB,CAAmB,CACf,kCAAaI,OAAb,aAAwBlB,aAAa,CAACW,QAAD,CAArC,EACH,CAFD,IAEO,IAAIG,OAAO,GAAK,CAAhB,CAAmB,CACtB,kCAAaQ,SAAb,aAA0BtB,aAAa,CAACW,QAAD,CAAvC,EACH,CACJ,CAPD,CASA,GAAIkE,CAAAA,GAAG,cAAG,2BAAK,SAAS,CAAC,cAAf,eACN,4CACI,2BAAK,SAAS,CAAC,iBAAf,EAAkCD,aAAa,EAA/C,CADJ,cAEI,2BAAK,SAAS,CAAC,WAAf,eACI,6BAAO,SAAS,CAAC,OAAjB,CAAyB,IAAI,CAAC,MAA9B,CAAqC,KAAK,CAAEpD,eAA5C,CAA6D,QAAQ,CAAEgD,iBAAvE,EADJ,cAEI,2BAAK,SAAS,CAAC,eAAf,CAA+B,OAAO,CAAE,kBAAM,CAC1C,GAAI1D,OAAO,GAAK,CAAhB,CAAmB,CACfW,kBAAkB,CAACqD,UAAU,CAAC5D,OAAD,CAAX,CAAlB,CACH,CAFD,IAEO,IAAIJ,OAAO,GAAK,CAAhB,CAAmB,CACtBW,kBAAkB,CAACqD,UAAU,CAACxD,SAAD,CAAX,CAAlB,CACH,CACJ,CAND,EAMIb,CAAC,CAAC,YAAD,CANL,CAFJ,CAFJ,CADM,CAAV,CAgBA,QAASsE,CAAAA,UAAT,CAAoBC,IAApB,CAA0B,CAEtB3B,OAAO,CAACC,GAAR,CAAY0B,IAAZ,EACAjE,UAAU,CAACiE,IAAD,CAAV,CAEA,GAAIA,IAAI,GAAK,CAAb,CAAgB,CACZpB,aAAa,GACb,OACH,CAED/C,OAAO,CAAC,IAAD,CAAP,CACH,CAED,QAASoE,CAAAA,eAAT,CAAyBD,IAAzB,CAA+B,CAC3B,GAAIA,IAAJ,CAAU,CACN,GAAIlE,OAAO,GAAK,CAAhB,CAAmB,CAEf,GAAI,CAAE,wBAAwBoE,IAAxB,CAA6B1D,eAA7B,CAAN,CAAsD,CAClDO,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CAED,GAAI,CAACiD,UAAU,CAACtD,eAAD,CAAf,CAAkC,CAC9BO,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CACD,GAAIiD,UAAU,CAACtD,eAAD,CAAV,CAA8BN,OAAlC,CAA2C,CACvCa,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CACDoC,QAAQ,GACX,CAnBD,IAmBO,CACH,GAAI,CAAE,wBAAwBiB,IAAxB,CAA6B1D,eAA7B,CAAN,CAAsD,CAClDO,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CAED,GAAI,CAACiD,UAAU,CAACtD,eAAD,CAAf,CAAkC,CAC9BO,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CACD,GAAIiD,UAAU,CAACtD,eAAD,CAAV,CAA8BF,SAAlC,CAA6C,CACzCS,YAAY,CAACtB,CAAC,CAAC,4BAAD,CAAF,CAAZ,CACAoB,YAAY,CAAC,IAAD,CAAZ,CACA,OACH,CACDiC,MAAM,GACT,CACJ,CAvCD,IAuCO,CACHrC,kBAAkB,CAAC,CAAD,CAAlB,CACH,CACDZ,OAAO,CAAC,KAAD,CAAP,CACH,CAED,GAAIsE,CAAAA,SAAJ,CACA,GAAI,CAAC/D,UAAL,CAAiB,CACb+D,SAAS,cAAG,oBAAC,UAAD,EAAY,GAAG,CAAEpF,YAAY,CAACY,QAAD,CAA7B,CAAyC,MAAM,CAAEO,OAAjD,CACY,IAAI,CAAElB,aAAa,CAACW,QAAD,CAAb,CAA0BF,CAAC,CAAC,eAAD,CAD7C,CAEY,OAAO,CAAEA,CAAC,CAAC,aAAD,CAAD,CAAmBT,aAAa,CAACW,QAAD,CAFrD,CAEiE,OAAO,CAAEoE,UAF1E,EAAZ,CAGH,CAJD,IAIO,CACHI,SAAS,cAAG,oBAAC,UAAD,EAAY,GAAG,CAAEpF,YAAY,CAACY,QAAD,CAA7B,CAAyC,MAAM,CAAEO,OAAjD,CACY,IAAI,CAAElB,aAAa,CAACW,QAAD,CAAb,CAA0BF,CAAC,CAAC,eAAD,CAD7C,CACgE,OAAO,CAAEA,CAAC,CAAC,gBAAD,CAD1E,CAEY,QAAQ,CAAEA,CAAC,CAAC,eAAD,CAFvB,CAE0C,OAAO,CAAEsE,UAFnD,EAAZ,CAGH,CAED,GAAMK,CAAAA,UAAU,CAAG,CACfC,UAAU,eAAiBtF,YAAY,CAACY,QAAD,CAA7B,KADK,CAEf2E,gBAAgB,CAAI,WAFL,CAGfC,cAAc,CAAM,MAHL,CAIfC,kBAAkB,CAAE,QAJL,CAAnB,CAOA,GAAIC,CAAAA,IAAI,CAAK,EAAb,CACA,GAAIC,CAAAA,MAAM,CAAG,EAAb,CAEA,GAAI/E,QAAQ,EAAI,iBAAZ,EAAiCA,QAAQ,EAAI,mBAAjD,CAAsE,CAClE8E,IAAI,CAAKhF,CAAC,CAAC,kBAAD,CAAV,CACAiF,MAAM,cAAG,oBAAC,UAAD,EAAY,GAAG,CAAE3F,YAAY,CAAC,WAAD,CAA7B,CAA4C,MAAM,CAAEiB,QAApD,CAA8D,IAAI,CAAEP,CAAC,CAAC,oBAAD,CAArE,CACY,OAAO,CAAEA,CAAC,CAAC,cAAD,CADtB,CACwC,OAAO,CAAE2C,cADjD,EAAT,CAEH,CAJD,IAIO,CACHqC,IAAI,CAAKhF,CAAC,CAAC,oBAAD,CAAV,CACAiF,MAAM,cAAG,oBAAC,UAAD,EAAY,GAAG,CAAE3F,YAAY,CAAC,aAAD,CAA7B,CAA8C,MAAM,CAAEiB,QAAtD,CAAgE,IAAI,CAAEP,CAAC,CAAC,sBAAD,CAAvE,CACY,OAAO,CAAEA,CAAC,CAAC,cAAD,CADtB,CACwC,OAAO,CAAE2C,cADjD,EAAT,CAEH,CAED,GAAMuC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACpB,GAAIjE,SAAJ,CAAe,CACX,mBACI,oBAAC,OAAD,MADJ,CAGH,CAJD,IAIO,CACH,mBACI,qDACI,2BAAK,SAAS,CAAC,YAAf,EACKgE,MADL,CAEKP,SAFL,CADJ,cAMI,2BAAK,SAAS,CAAC,eAAf,CAA+B,OAAO,CAAEzB,WAAxC,EAAsDjD,CAAC,CAAC,wBAAD,CAAvD,CANJ,CADJ,CAUH,CACJ,CAjBD,CAmBA,mBACI,2BAAK,SAAS,CAAC,QAAf,eACI,2BAAK,SAAS,CAAC,eAAf,eACI,2BAAK,SAAS,CAAC,aAAf,eACI,2BAAK,SAAS,CAAC,iBAAf,CAAiC,KAAK,CAAE2E,UAAxC,EADJ,CADJ,cAKI,2BAAK,SAAS,CAAC,WAAf,eACI,2BAAK,SAAS,CAAC,iBAAf,EAAkCpF,aAAa,CAACW,QAAD,CAA/C,CADJ,CALJ,cAQI,2BAAK,SAAS,CAAC,cAAf,eACI,+BAAMF,CAAC,CAAC,gBAAD,CAAP,CADJ,cAEI,2BAAK,SAAS,CAAC,mBAAf,SAA0CT,aAAa,CAACW,QAAD,CAAvD,QAFJ,cAGI,+BAAM8E,IAAN,CAHJ,CARJ,CADJ,CAeKE,SAAS,EAfd,CAgBK/E,IAAI,eAAI,oBAAC,MAAD,EAAQ,GAAG,CAAEiE,GAAb,CAAkB,KAAK,CAAEpE,CAAC,CAAC,cAAD,CAA1B,CAA4C,OAAO,CAAEK,OAArD,CAA8D,OAAO,CAAE,IAAvE,CACQ,eAAe,CAAEmE,eADzB,EAhBb,cAmBI,oBAAC,QAAD,EACI,YAAY,CAAE,CAACW,QAAQ,CAAE,KAAX,CAAkBC,UAAU,CAAE,OAA9B,CADlB,CAEI,IAAI,CAAEjE,SAFV,CAGI,gBAAgB,CAAE,IAHtB,CAII,OAAO,CAAEC,YAJb,eAKI,oBAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,EACKC,SADL,CALJ,CAnBJ,CADJ,CA+BH,CAED,cAAetB,CAAAA,MAAf","sourcesContent":["import React, {useState, useEffect} from 'react'\r\n\r\nimport MuiAlert from '@material-ui/lab/Alert'\r\nimport Snackbar from '@material-ui/core/Snackbar'\r\n\r\nimport DetailItem from '../../components/DetailItem/DetailItem'\r\nimport MsgBox from '../../components/MsgBox/MsgBox'\r\n\r\nimport Loading from '../../components/Loading'\r\n\r\nimport {useLocation} from 'react-router-dom'\r\nimport {useTranslation} from 'react-i18next'\r\n\r\n// import tigerLogo from '../../assets/tiger-logo.png';\r\nimport tigerLogo from '../../assets/1.png'\r\n\r\nimport wallet from '../../tools/wallet'\r\nimport conf from '../../tools/conf'\r\n\r\nimport {sleep, getUrlParams, formatBigNumber} from '../../tools'\r\n\r\nimport './Detail.css'\r\n\r\nconst {poolTitleImg} = require('../../assets/converge')\r\n\r\n// 池子标题名字\r\nconst poolTitleName = {\r\n    usdtPoolAddress:   'USDT/TRX LP',\r\n    fomoPoolAddress:   'FOMO/TRX LP',\r\n    fomoX9PoolAddress: 'FOMOX9/TRX LP',\r\n    mvmPoolAddress:    'MVM/TRX LP',\r\n    famPoolAddress:    'FAM/TRX LP'\r\n}\r\n\r\nfunction Alert(props) {\r\n    return <MuiAlert elevation={6} variant=\"filled\" {...props} />\r\n}\r\n\r\nfunction Detail() {\r\n\r\n    const {t} = useTranslation()\r\n\r\n    // 使用这个变量去区分是哪个池子，个性化设置等、比如图标之类\r\n    // 真不理解为什么不用 pollName 这个变量去做，非要再处理个 src 属性\r\n    const {poolName} = getUrlParams(useLocation().search)\r\n\r\n    const [show, setShow]       = useState(false)\r\n    const [popType, setPopType] = useState(0) // 根据状态去判断当前功能、0 批准，1 解压，2质押\r\n\r\n    const [obtained, setObtained] = useState(0) // 已获得\r\n    const [pledged, setPledged]   = useState(0) // 已抵押\r\n\r\n    // 是否批准，根据 isApproved 这个变量显示显示几个按钮，为 false 一个按钮， true 为两个按钮\r\n    const [isApproved, setApproved] = useState(false)\r\n\r\n    const [lpBalance, setLpBalance] = useState(0) // lp 余额\r\n\r\n    const [amountSubmitted, setAmountSubmitted] = useState(0) // 提交的金额\r\n    const [isLoading, setLoading]               = useState(true) // 加载状态\r\n\r\n    const [openError, setOpenError] = React.useState(false) // 错误提示\r\n    const [errorInfo, setErrorInfo] = React.useState('This is a error!') // 错误提信息\r\n\r\n    // 一起更新所有吧\r\n    const upDateAll = async () => {\r\n\r\n        if (wallet.getDefaultAddress().code === 0) {\r\n\r\n            const myAddress   = wallet.getDefaultAddress().data\r\n            const poolAddress = conf.pool[poolName]\r\n            const lpAddress   = conf.lp[poolName]\r\n// console.log(myAddress)\r\n// console.log(poolAddress)\r\n// console.log(lpAddress)\r\n            const [earnedRes, pledgedRes, allowanceRes, lpRes] = await Promise.all([\r\n                wallet._getEarned(poolAddress),\r\n                wallet._getBalanceOf(poolAddress, myAddress),\r\n                wallet.allowance(lpAddress, myAddress, poolAddress),\r\n                wallet._getBalanceOf(lpAddress, myAddress),\r\n            ])\r\n\r\n            setObtained(formatBigNumber(earnedRes.data))\r\n\r\n            // if (poolName === 'cornPoolAddress') {\r\n            //     setPledged((Number(formatBigNumber(pledgedRes.data, 1e18))));\r\n            //     setLpBalance((Number(formatBigNumber(lpRes.data, 1e18))));\r\n            // } else {\r\n            //     setPledged(Number(formatBigNumber(pledgedRes.data, 1e6)));\r\n            //     setLpBalance(Number(formatBigNumber(lpRes.data, 1e6)));\r\n            // }\r\n            setPledged(Number(formatBigNumber(pledgedRes.data, 1e6)))\r\n            setLpBalance(Number(formatBigNumber(lpRes.data, 1e6)))\r\n\r\n            if (allowanceRes.data.comparedTo(1) > 0) {\r\n                setApproved(true)\r\n            } else {\r\n                setApproved(false)\r\n            }\r\n\r\n            setLoading(false)\r\n\r\n        } else {\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // 收割\r\n    const onclickHarvest = async () => {\r\n        if (Number(obtained) > 0) {\r\n\r\n            // 可以添加 loading 开始，其实就是控制一个变量为 true\r\n            console.log('开始收割')\r\n\r\n            await wallet.getReward(conf.pool[poolName]) // 这里可以监听错误\r\n\r\n            console.log('收割完成')\r\n            // 结束 loading 开始，其实就是控制一个变量为 false\r\n        }\r\n    }\r\n\r\n    // 轮训，更新，10 秒更新一次\r\n    const training = async () => {\r\n\r\n        await sleep(20 * 1000)\r\n\r\n        for (; ;) {\r\n            try {\r\n                await sleep(8 * 1000)\r\n                await upDateAll()\r\n            } catch (err) {\r\n                console.error(err)\r\n            }\r\n        }\r\n    }\r\n\r\n    // 收割并解压\r\n    const onClickExit = async () => {\r\n\r\n        if (obtained <= 0) {\r\n            console.log('数量不足')\r\n            // return;\r\n        } else {\r\n            console.log('return')\r\n        }\r\n\r\n        // 可以添加 loading 开始，其实就是控制一个变量为 true\r\n        console.log('开始收割并解压')\r\n\r\n        await wallet.exit(conf.pool[poolName]) // 这里可以监听错误\r\n\r\n        upDateAll()\r\n        console.log('收割并解压完成')\r\n        // 结束 loading 开始，其实就是控制一个变量为 false\r\n    }\r\n\r\n    // 批准授权\r\n    const approveAuthor = async () => {\r\n\r\n        try {\r\n            // 可以添加 loading 开始，其实就是控制一个变量为 true\r\n            console.log('开始批准授权')\r\n\r\n            await wallet.approve(conf.lp[poolName], conf.pool[poolName]) // 这里可以监听错误\r\n\r\n            upDateAll()\r\n            console.log('批准授权完成')\r\n            // 结束 loading 开始，其实就是控制一个变量为 false\r\n        } catch (err) {\r\n            console.error(err)\r\n        }\r\n\r\n    }\r\n\r\n    // 质押\r\n    const invest = async () => {\r\n\r\n        if (amountSubmitted <= 0) return\r\n\r\n        // 可以添加 loading 开始，其实就是控制一个变量为 true\r\n        console.log('开始质押>>>', amountSubmitted)\r\n\r\n        const amount = amountSubmitted\r\n\r\n        // if (poolName === 'cornPoolAddress') {\r\n        //     await wallet.safeInvest(conf.pool[poolName], conf.lp[poolName], (amount * 1e18)); // 这里可以监听错误\r\n        // } else {\r\n        //     await wallet.safeInvest(conf.pool[poolName], conf.lp[poolName], (amount * 1e6)); // 这里可以监听错误\r\n        // }\r\n        await wallet.safeInvest(conf.pool[poolName], conf.lp[poolName], (amount * 1e6)) // 这里可以监听错误\r\n        // lp 地址可能不需要，但也要传值\r\n\r\n        await sleep(50) // 区块链有延迟 延迟一下再去获取\r\n        setAmountSubmitted(0)\r\n        upDateAll()\r\n\r\n        console.log('质押完成')\r\n        // 结束 loading 开始，其实就是控制一个变量为 false\r\n    }\r\n\r\n    // 撤出投资\r\n    const withdraw = async () => {\r\n\r\n        if (amountSubmitted <= 0) return\r\n\r\n        // 可以添加 loading 开始，其实就是控制一个变量为 true\r\n        console.log('开始撤出投资')\r\n\r\n        const amount = amountSubmitted\r\n\r\n        if (poolName === 'cornPoolAddress') {\r\n            await wallet.withdraw(conf.pool[poolName], (amount * 1e18).toString()) // 这里可以监听错误\r\n\r\n        } else {\r\n            await wallet.withdraw(conf.pool[poolName], (amount * 1e6).toString()) // 这里可以监听错误\r\n        }\r\n        // lp 地址可能不需要，但也要传值\r\n\r\n        await sleep(50) // 区块链有延迟 延迟一下再去获取\r\n        setAmountSubmitted(0)\r\n\r\n        upDateAll()\r\n        console.log('撤出投资完成')\r\n        // 结束 loading 开始，其实就是控制一个变量为 false\r\n    }\r\n\r\n    useEffect(() => {\r\n        wallet.eventEmitter.on(wallet.eventConstant.wallet_connection, upDateAll)\r\n\r\n        // upDateAll();\r\n        training() // 轮训\r\n\r\n        return () => {\r\n            wallet.eventEmitter.removeListener(wallet.eventConstant.wallet_connection, upDateAll)\r\n        }\r\n    }, [])\r\n\r\n    // 监听输入框的数据\r\n    const inputHandleChange = (event) => {\r\n\r\n        // let curValue = Number(event.target.value);\r\n\r\n        setAmountSubmitted(event.target.value)\r\n    }\r\n\r\n    const calcAvailable = () => {\r\n        console.log('lpBalance>>>>>', lpBalance)\r\n        if (popType === 1) {\r\n            return `可用：${pledged} ${poolTitleName[poolName]}`\r\n        } else if (popType === 2) {\r\n            return `可用：${lpBalance} ${poolTitleName[poolName]}`\r\n        }\r\n    }\r\n\r\n    let msg = <div className=\"msg-box-body\">\r\n        <div>\r\n            <div className=\"awaylable-money\">{calcAvailable()}</div>\r\n            <div className=\"input-box\">\r\n                <input className=\"input\" type=\"text\" value={amountSubmitted} onChange={inputHandleChange}/>\r\n                <div className=\"max-money btn\" onClick={() => {\r\n                    if (popType === 1) {\r\n                        setAmountSubmitted(parseFloat(pledged))\r\n                    } else if (popType === 2) {\r\n                        setAmountSubmitted(parseFloat(lpBalance))\r\n                    }\r\n                }}>{t('detail.max')}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    function showMsgBox(type) {\r\n\r\n        console.log(type)\r\n        setPopType(type)\r\n\r\n        if (type === 0) {\r\n            approveAuthor()\r\n            return\r\n        }\r\n\r\n        setShow(true)\r\n    }\r\n\r\n    function confirmCallBack(type) {\r\n        if (type) {\r\n            if (popType === 1) {\r\n\r\n                if (!(/^\\d+(?=\\.{0,1}\\d+$|$)/.test(amountSubmitted))) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n\r\n                if (!parseFloat(amountSubmitted)) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n                if (parseFloat(amountSubmitted) > pledged) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n                withdraw()\r\n            } else {\r\n                if (!(/^\\d+(?=\\.{0,1}\\d+$|$)/.test(amountSubmitted))) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n\r\n                if (!parseFloat(amountSubmitted)) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n                if (parseFloat(amountSubmitted) > lpBalance) {\r\n                    setErrorInfo(t('detail.insufficientBalance'))\r\n                    setOpenError(true)\r\n                    return\r\n                }\r\n                invest()\r\n            }\r\n        } else {\r\n            setAmountSubmitted(0)\r\n        }\r\n        setShow(false)\r\n    }\r\n\r\n    let detaiItem\r\n    if (!isApproved) {\r\n        detaiItem = <DetailItem src={poolTitleImg[poolName]} number={pledged}\r\n                                text={poolTitleName[poolName] + t('detail.staked')}\r\n                                btnText={t('detail.feed') + poolTitleName[poolName]} onClick={showMsgBox}/>\r\n    } else {\r\n        detaiItem = <DetailItem src={poolTitleImg[poolName]} number={pledged}\r\n                                text={poolTitleName[poolName] + t('detail.staked')} btnText={t('detail.unstake')}\r\n                                btnText2={t('detail.pledge')} onClick={showMsgBox}/>\r\n    }\r\n\r\n    const backGround = {\r\n        background:         `url(${poolTitleImg[poolName]})`,\r\n        backgroundRepeat:   'no-repeat',\r\n        backgroundSize:     '100%',\r\n        backgroundPosition: 'center'\r\n    }\r\n\r\n    let earn   = \"\"\r\n    let earned = \"\"\r\n\r\n    if (poolName == \"usdtPoolAddress\" || poolName == \"fomoX9PoolAddress\") {\r\n        earn   = t('detail.earn_fomo')\r\n        earned = <DetailItem src={poolTitleImg[\"fomoTrc20\"]} number={obtained} text={t('detail.earned_fomo')}\r\n                             btnText={t('detail.adopt')} onClick={onclickHarvest}/>\r\n    } else {\r\n        earn   = t('detail.earn_fomox9')\r\n        earned = <DetailItem src={poolTitleImg[\"fomoX9Trc20\"]} number={obtained} text={t('detail.earned_fomox9')}\r\n                             btnText={t('detail.adopt')} onClick={onclickHarvest}/>\r\n    }\r\n\r\n    const rendering = () => {\r\n        if (isLoading) {\r\n            return (\r\n                <Loading/>\r\n            )\r\n        } else {\r\n            return (\r\n                <>\r\n                    <div className=\"detai-list\">\r\n                        {earned}\r\n                        {detaiItem}\r\n                    </div>\r\n\r\n                    <div className=\"detai-btn btn\" onClick={onClickExit}>{t('detail.adoptAndUnstake')}</div>\r\n                </>\r\n            )\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"detail\">\r\n            <div className=\"detail-slogan\">\r\n                <div className=\"slogan-logo\">\r\n                    <div className=\"slogan-logo-img\" style={backGround}></div>\r\n                </div>\r\n\r\n                <div className=\"text-logo\">\r\n                    <div className=\"text-logo-text1\">{poolTitleName[poolName]}</div>\r\n                </div>\r\n                <div className=\"slogan-title\">\r\n                    <div>{t('detail.deposit')}</div>\r\n                    <div className=\"slogan-title-name\">&nbsp;{poolTitleName[poolName]}&nbsp;</div>\r\n                    <div>{earn}</div>\r\n                </div>\r\n            </div>\r\n            {rendering()}\r\n            {show && <MsgBox msg={msg} title={t('detail.feed2')} popType={popType} confirm={true}\r\n                             confirmCallBack={confirmCallBack}/>}\r\n\r\n            <Snackbar\r\n                anchorOrigin={{vertical: 'top', horizontal: 'right'}}\r\n                open={openError}\r\n                autoHideDuration={1500}\r\n                onClose={setOpenError}>\r\n                <Alert severity=\"error\">\r\n                    {errorInfo}\r\n                </Alert>\r\n            </Snackbar>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Detail\r\n"]},"metadata":{},"sourceType":"module"}